<blocks app="Snap! 7, https://snap.berkeley.edu" version="2"><palette><category name="EEZYbot" color="204,197,61,1"/></palette><block-definition s="Verbind met EEZYbot ARM op %&apos;server&apos; en poort %&apos;poort&apos;" type="command" category="EEZYbot"><header></header><code></code><translations></translations><inputs><input type="%txt">eezybot01</input><input type="%n">8000</input></inputs><script><custom-block s="create %s var %mult%txt"><l>global</l><list><l>isReady</l></list></custom-block><custom-block s="set var %s to %s"><l>isReady</l><block s="reportBoolean"><l><bool>false</bool></l></block></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>hostname</l><l>port</l><l>proc</l></list><l>&#xD;console.log("Verbind - begin");&#xD;&#xD;socket = null;&#xD;&#xD;window.socket = new WebSocket("ws:" + hostname + ":" + String(port));&#xD;&#xD;window.socket.onmessage = function (message) {&#xD;  console.log("Message data: " + message.data);&#xD;  ide = world.children[0];&#xD;  ide.setVar("isReady",true);&#xD;&#xD;}&#xD;&#xD;window.socket.onopen = function () {&#xD;&#xD;  // initialize the connection to the robot arm&#xD;&#xD;  window.socket.send("init");&#xD;}&#xD;&#xD;console.log("Verbind - einde");&#xD;</l></block><list><block var="server"/><block var="poort"/><l></l></list></block><block s="doWaitUntil"><custom-block s="var %s"><l>isReady</l></custom-block></block></script></block-definition><block-definition s="Verbreek verbinding met EEZYbot ARM" type="command" category="EEZYbot"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>proc</l></list><l>window.socket.send("disconnect");&#xD;window.socket.onclose = function () {}; // disable onclose handler first&#xD;window.socket.onmessage = function () {};&#xD;&#xD;window.socket.close();                  // close the socket.&#xD;socket = null;&#xD;&#xD;</l></block><list></list></block></script></block-definition><block-definition s="Zet poortje %&apos;positie&apos;" type="command" category="EEZYbot"><header></header><code></code><translations></translations><inputs><input type="%txt">open<options>open&#xD;dicht</options></input></inputs><script><custom-block s="set var %s to %s"><l>isReady</l><block s="reportBoolean"><l><bool>false</bool></l></block></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>action</l></list><l>&#xD;console.log("Zet poortje - begin");&#xD;&#xD;if (action == "open") {&#xD;  window.socket.send("setgate open");&#xD;} else {&#xD;  window.socket.send("setgate close");&#xD;}&#xD;&#xD;console.log("Zet poortje - einde");&#xD;</l></block><list><block var="positie"/></list></block><block s="doWaitUntil"><custom-block s="var %s"><l>isReady</l></custom-block></block></script></block-definition><block-definition s="Zet neutraal" type="command" category="EEZYbot"><header></header><code></code><translations></translations><inputs></inputs><script><custom-block s="set var %s to %s"><l>isReady</l><block s="reportBoolean"><l><bool>false</bool></l></block></custom-block><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>&#xD;window.socket.send("setneutral");&#xD;</l></block><list></list></block><block s="doWaitUntil"><custom-block s="var %s"><l>isReady</l></custom-block></block></script></block-definition><block-definition s="Grijper positie %&apos;positie&apos;" type="command" category="EEZYbot"><header></header><code></code><translations></translations><inputs><input type="%n">90</input></inputs><script><custom-block s="set var %s to %s"><l>isReady</l><block s="reportBoolean"><l><bool>false</bool></l></block></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>pos</l></list><l>function positionLimit (pos) {&#xD;   pos = Math.floor(pos);&#xD;   pos = parseInt(pos);&#xD;   pos = Math.min(180,pos);&#xD;   pos = Math.max(0,pos);&#xD;   return pos;&#xD;};&#xD;&#xD;pos = positionLimit (pos);&#xD;var msg = "setgripper " + String(pos);&#xD;window.socket.send(msg);&#xD;</l></block><list><block var="positie"/></list></block><block s="doWaitUntil"><custom-block s="var %s"><l>isReady</l></custom-block></block></script></block-definition><block-definition s="Zet arm in positie %&apos;p1&apos; , %&apos;p2&apos; , %&apos;p3&apos; met snelheid %&apos;snelheid&apos;" type="command" category="EEZYbot"><header></header><code></code><translations></translations><inputs><input type="%n">90</input><input type="%n">90</input><input type="%n">90</input><input type="%n">40</input></inputs><script><custom-block s="set var %s to %s"><l>isReady</l><block s="reportBoolean"><l><bool>false</bool></l></block></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>p1</l><l>p2</l><l>p3</l><l>speed</l></list><l>function positionLimit (pos) {&#xD;   pos = Math.floor(pos);&#xD;   pos = parseInt(pos);&#xD;   pos = Math.min(180,pos);&#xD;   pos = Math.max(0,pos);&#xD;   return pos;&#xD;};&#xD;&#xD;p1 = positionLimit (p1);&#xD;p2 = positionLimit (p2);&#xD;p3 = positionLimit (p3);&#xD;window.socket.send("setarm " + String(p1) + " " + String(p2) + " " + String(p3) + " " + String(speed));&#xD;&#xD;</l></block><list><block var="p1"/><block var="p2"/><block var="p3"/><block var="snelheid"/></list></block><block s="doWaitUntil"><custom-block s="var %s"><l>isReady</l></custom-block></block></script></block-definition></blocks>
